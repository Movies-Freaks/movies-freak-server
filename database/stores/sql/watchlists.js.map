{"version":3,"file":"watchlists.js","sourceRoot":"","sources":["watchlists.ts"],"names":[],"mappings":";;;;;;;;;AACA,OAAO,EAAE,IAAI,EAAE,MAAM,QAAQ,CAAC;AAE9B,OAAO,EAAE,oBAAoB,EAAE,MAAM,UAAU,CAAC;AAEhD,OAAO,EAAE,mBAAmB,EAAE,MAAM,eAAe,CAAC;AAGpD,MAAM,kBAAkB;IAGtB,YAAY,UAAgB;QAC1B,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;IAC/B,CAAC;IAEK,MAAM,CAAC,SAAoB;;YAC/B,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAE/C,IAAI,MAAY,CAAC;YAEjB,IAAI,CAAC;gBACH,CAAC,MAAM,CAAC,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC;qBAC3C,SAAS,CAAC,GAAG,CAAC;qBACd,MAAM,CAAC,YAAY,CAAC,CAAC;YAC1B,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,MAAM,IAAI,oBAAoB,CAAC,KAAK,CAAC,CAAC;YACxC,CAAC;YAED,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAClC,CAAC;KAAA;IAEO,SAAS,CAAC,SAAoB;QACpC,MAAM,IAAI,GAAG,mBAAmB,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QAEnD,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC,aAAa,EAAE,mBAAmB,CAAC,CAAC,CAAC;IAC1D,CAAC;IAEO,WAAW,CAAC,IAAU;QAC5B,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACrB,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC;QAE3B,OAAO,mBAAmB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAC5C,CAAC;CACF;AAED,eAAe,kBAAkB,CAAC","sourcesContent":["import { Knex } from 'knex';\nimport { omit } from 'lodash';\n\nimport { SQLDatabaseException } from './errors';\nimport { Watchlist } from '../../../app/moviesFreak/entities';\nimport { WatchlistSerializer } from './serializers';\nimport { Json } from '../../../types/common';\n\nclass SQLWatchlistsStore {\n  private connection: Knex;\n\n  constructor(connection: Knex) {\n    this.connection = connection;\n  }\n\n  async create(watchlist: Watchlist) {\n    const dataToInsert = this.serialize(watchlist);\n\n    let result: Json;\n\n    try {\n      [result] = await this.connection('watchlists')\n        .returning('*')\n        .insert(dataToInsert);\n    } catch (error: any) {\n      throw new SQLDatabaseException(error);\n    }\n\n    return this.deserialize(result);\n  }\n\n  private serialize(watchlist: Watchlist): Json {\n    const data = WatchlistSerializer.toJSON(watchlist);\n\n    return omit(data, ['total_films', 'total_tv_episodes']);\n  }\n\n  private deserialize(data: Json) {\n    data.total_films = 0;\n    data.total_tv_episodes = 0;\n\n    return WatchlistSerializer.fromJSON(data);\n  }\n}\n\nexport default SQLWatchlistsStore;\n"]}